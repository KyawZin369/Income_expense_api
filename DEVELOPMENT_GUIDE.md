# Development Guide - Where to Write Code

## üìç GraphQL Controllers (Resolvers)

In GraphQL, **resolvers** are equivalent to REST controllers. They handle all the business logic for queries and mutations.

### Main Resolver File
**Location:** `pkg/api/graph/resolver/schema.resolvers.go`

This is where you write **most of your GraphQL controller code**. This file contains:

1. **Query Resolvers** - Handle read operations (GET requests equivalent)
   - Example: `Users()`, `User(id)`, `Accounts()`, etc.
   - Located in `queryResolver` struct methods

2. **Mutation Resolvers** - Handle write operations (POST/PUT/DELETE equivalent)
   - Example: `CreateUser()`, `CreateAccount()`, `CreateExpense()`, etc.
   - Located in `mutationResolver` struct methods

3. **Field Resolvers** - Handle nested field resolution
   - Example: `User.Accounts()`, `Account.Currency()`, etc.
   - Located in type-specific resolver structs (e.g., `userResolver`, `accountResolver`)

### Example: Implementing a Query Resolver

```go
// In pkg/api/graph/resolver/schema.resolvers.go

// Accounts is the resolver for the accounts field.
func (r *queryResolver) Accounts(ctx context.Context) ([]*models.Account, error) {
    var accounts []*models.Account
    if err := r.DB.Find(&accounts).Error; err != nil {
        return nil, err
    }
    return accounts, nil
}
```

### Example: Implementing a Mutation Resolver

```go
// In pkg/api/graph/resolver/schema.resolvers.go

// CreateAccount is the resolver for the createAccount field.
func (r *mutationResolver) CreateAccount(ctx context.Context, input generated.NewAccountInput) (*models.Account, error) {
    account := &models.Account{
        UserID:     input.UserID,
        Name:       input.Name,
        Type:       input.Type,
        CurrencyID: input.CurrencyID,
        Balance:    input.Balance,
        IsActive:   true,
    }
    
    if err := r.DB.Create(account).Error; err != nil {
        return nil, err
    }
    
    return account, nil
}
```

### Resolver Structure File
**Location:** `pkg/api/graph/graph.go`

This file defines the main `Resolver` struct that holds your database connection and other dependencies. You typically don't modify this file unless you need to add new dependencies to the resolver.

---

## üìÇ Where to Write Code - Project Structure

### 1. **GraphQL Schema Definition**
**Location:** `pkg/api/graph/schema/schema.graphqls`

- Define your GraphQL types, queries, and mutations here
- This is your API contract
- After modifying, run `go run github.com/99designs/gqlgen generate` to regenerate resolver stubs

### 2. **GraphQL Resolvers (Controllers)**
**Location:** `pkg/api/graph/resolver/schema.resolvers.go`

- **This is where you write most of your business logic**
- Implement all query and mutation handlers
- Access database via `r.DB` (GORM instance)

### 3. **Data Models**
**Location:** `pkg/models/`

- Define your database models (structs)
- Each file represents a model (e.g., `user.go`, `account.go`, `expense.go`)
- These are GORM models that map to database tables

### 4. **Database Configuration**
**Location:** `pkg/database/database.go`

- Database connection setup
- Migration logic
- Database utilities

### 5. **Configuration**
**Location:** `pkg/config/config.go`

- Application configuration
- Environment variables
- Settings management

### 6. **Utilities**
**Location:** `pkg/utils/`

- Helper functions
- Common utilities
- Shared code

### 7. **Application Entry Point**
**Location:** `cmd/server/main.go`

- Server setup
- GraphQL handler registration
- HTTP server configuration

---

## üîÑ Typical Development Workflow

1. **Define Schema** ‚Üí Edit `pkg/api/graph/schema/schema.graphqls`
2. **Generate Resolvers** ‚Üí Run `go run github.com/99designs/gqlgen generate`
3. **Implement Logic** ‚Üí Edit `pkg/api/graph/resolver/schema.resolvers.go`
4. **Update Models** ‚Üí Edit files in `pkg/models/` if needed
5. **Test** ‚Üí Use GraphQL Playground (usually at `http://localhost:8080/`)

---

## üìù Important Notes

### Auto-Generated Files
**DO NOT EDIT:**
- `pkg/api/graph/generated/generated.go`
- `pkg/api/graph/generated/models_gen.go`
- `pkg/api/graph/generated/schema.graphqls`

These are auto-generated by gqlgen. If you need to regenerate them, run:
```bash
go run github.com/99designs/gqlgen generate
```

### Resolver File Regeneration
The `schema.resolvers.go` file is **partially generated**. When you run `gqlgen generate`:
- New resolver stubs are added for new schema fields
- Your existing implementations are preserved
- Unknown code is moved to the end of the file

### Accessing Database in Resolvers
All resolvers have access to the database via `r.DB`:
```go
func (r *queryResolver) Accounts(ctx context.Context) ([]*models.Account, error) {
    var accounts []*models.Account
    // r.DB is available here
    if err := r.DB.Find(&accounts).Error; err != nil {
        return nil, err
    }
    return accounts, nil
}
```

---

## üéØ Quick Reference

| What to Write | Where to Write It |
|--------------|-------------------|
| GraphQL Queries/Mutations | `pkg/api/graph/resolver/schema.resolvers.go` |
| GraphQL Schema | `pkg/api/graph/schema/schema.graphqls` |
| Database Models | `pkg/models/*.go` |
| Business Logic | `pkg/api/graph/resolver/schema.resolvers.go` |
| Database Setup | `pkg/database/database.go` |
| Configuration | `pkg/config/config.go` |
| Utilities | `pkg/utils/` |
| Server Setup | `cmd/server/main.go` |

---

## üí° Example: Complete Feature Implementation

Let's say you want to add a "Get User Expenses" feature:

1. **Schema already defined** in `schema.graphqls` (line 268: `userExpenses(userId: ID!): [Expense!]!`)

2. **Implement the resolver** in `schema.resolvers.go`:
```go
func (r *queryResolver) UserExpenses(ctx context.Context, userID string) ([]*models.Expense, error) {
    var expenses []*models.Expense
    if err := r.DB.Where("user_id = ?", userID).Find(&expenses).Error; err != nil {
        return nil, err
    }
    return expenses, nil
}
```

3. **Done!** The GraphQL endpoint is now available.

---

## üöÄ Summary

**Most of your code goes in:** `pkg/api/graph/resolver/schema.resolvers.go`

This is your main "controller" file where you implement all GraphQL operations. Think of it as the equivalent of REST API controllers in a traditional REST application.

